<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Nova Assistant</title>
  <style>
    :root {
      --bg: radial-gradient(circle at 30% 30%, #10141b, #050607 70%);
      --glass: rgba(255,255,255,0.08);
      --glass-border: rgba(255,255,255,0.12);
      --accent1: #00c6ff;
      --accent2: #0078ff;
      --accent3: #9d4dff;
      --danger: #ff9900;
      --text: #e8eef5;
      --font-stack: 'Segoe UI', system-ui, sans-serif;
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family: var(--font-stack); background: var(--bg); color: var(--text); display:flex; flex-direction:column; align-items:center; padding:34px 26px 40px; }
    h2 { margin:0 0 6px; font-weight:600; letter-spacing:.5px; background: linear-gradient(90deg,var(--accent1),var(--accent3)); -webkit-background-clip:text; background-clip:text; color: transparent; }
    .subtitle { font-size:13px; opacity:.7; margin-bottom:18px; }

    /* Siri-style multicolor core */
    .core-wrapper { position:relative; width:210px; height:210px; }
    .circle { position:relative; width:100%; height:100%; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:22px; font-weight:600; letter-spacing:1px; color:#fff; background:conic-gradient(from 0deg, var(--accent1), var(--accent2), var(--accent3), var(--accent1)); filter:brightness(1.1); animation: spin 10s linear infinite; box-shadow:0 0 30px -5px var(--accent2), 0 0 70px -15px var(--accent3); overflow:hidden; }
    .circle::after { content:""; position:absolute; inset:10px; border-radius:50%; background:radial-gradient(circle, rgba(255,255,255,0.15), rgba(0,0,0,0.75)); backdrop-filter: blur(4px); box-shadow: inset 0 0 25px rgba(255,255,255,0.12); animation: breathing 5s ease-in-out infinite; }

    @keyframes spin { 0%{ transform:rotate(0deg);} 100%{ transform:rotate(360deg);} }
    @keyframes breathing { 0%{transform:scale(1);} 50%{transform:scale(1.04);} 100%{transform:scale(1);} }

    /* Waveform (speaking/listening visualization) */
    .waveform { position:absolute; bottom:-40px; left:50%; transform:translateX(-50%); display:flex; gap:6px; height:60px; align-items:flex-end; pointer-events:none; }
    .bar { width:8px; background:linear-gradient(180deg,var(--accent1),var(--accent3)); border-radius:4px; animation: wave 1.2s ease-in-out infinite; opacity:.85; }
    .bar:nth-child(odd){ background:linear-gradient(180deg,var(--accent2),var(--accent3)); }
    .bar:nth-child(1){ animation-delay:.0s;} .bar:nth-child(2){ animation-delay:.15s;} .bar:nth-child(3){ animation-delay:.3s;} .bar:nth-child(4){ animation-delay:.45s;} .bar:nth-child(5){ animation-delay:.6s;} .bar:nth-child(6){ animation-delay:.75s;} .bar:nth-child(7){ animation-delay:.9s;} .bar:nth-child(8){ animation-delay:1.05s;}
    @keyframes wave { 0%,100%{ height:12px;} 50%{ height:55px;} }
    .waveform.hidden { display:none; }

    /* Glass cards */
    .card { width:100%; max-width:520px; background:var(--glass); border:1px solid var(--glass-border); backdrop-filter: blur(18px) saturate(140%); padding:18px 20px 20px; border-radius:20px; box-shadow:0 8px 24px -12px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.05); position:relative; overflow:hidden; }
    .card::before { content:""; position:absolute; top:-40%; left:-30%; width:80%; height:180%; background:radial-gradient(circle at center, rgba(255,255,255,0.08), transparent 70%); transform:rotate(25deg); }
    .card.compact { padding:14px 16px; }
    .grid-row { display:flex; gap:12px; margin-top:14px; }

    textarea { width:100%; min-height:110px; resize:vertical; border:none; outline:none; font-size:15px; line-height:1.35; color:var(--text); background:rgba(0,0,0,0.35); border-radius:14px; padding:14px 16px; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.08), inset 0 0 18px -6px rgba(0,0,0,0.7); }
    textarea::placeholder { color:#98a6b6; }

    button { position:relative; background:linear-gradient(140deg,var(--accent2),var(--accent3)); border:none; color:#fff; font-weight:500; padding:12px 22px; border-radius:14px; letter-spacing:.4px; cursor:pointer; font-size:14px; display:flex; align-items:center; gap:6px; box-shadow:0 4px 16px -6px var(--accent2), 0 0 0 1px rgba(255,255,255,0.08); transition: .25s cubic-bezier(.4,.2,.2,1); }
    button:hover { transform:translateY(-3px); box-shadow:0 8px 22px -6px var(--accent3); }
    button:active { transform:translateY(0); }
    button.secondary { background:linear-gradient(140deg,#37424f,#1e252c); box-shadow:0 4px 14px -6px rgba(0,0,0,0.6); }
    button.secondary:hover { box-shadow:0 8px 22px -6px rgba(0,0,0,0.55); }
    button.danger { background:linear-gradient(140deg,#ff9d2e,#ff3d2e); }
    button:disabled { opacity:.5; cursor:not-allowed; transform:none; }

    /* Pending destructive actions */
    .pending-item { background:linear-gradient(90deg, rgba(255,153,0,0.18), rgba(255,61,46,0.22)); padding:10px 12px; border-radius:12px; font-size:12.8px; line-height:1.3; margin:6px 0; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06); }
    .pending-head { font-size:14px; font-weight:600; margin:0 0 8px; letter-spacing:.5px; background: linear-gradient(90deg,#ff9d2e,#ff3d2e); -webkit-background-clip:text; background-clip:text; color:transparent; }

    /* Activity / log */
    .log { height:220px; overflow-y:auto; font-size:12.6px; white-space:pre-wrap; background:rgba(0,0,0,0.35); border-radius:16px; padding:14px 16px; box-shadow:inset 0 0 0 1px rgba(255,255,255,0.07), inset 0 0 22px -8px rgba(0,0,0,0.9); }
    .log::-webkit-scrollbar { width:8px; }
    .log::-webkit-scrollbar-track { background:rgba(255,255,255,0.05); border-radius:8px; }
    .log::-webkit-scrollbar-thumb { background:linear-gradient(180deg,var(--accent2),var(--accent3)); border-radius:8px; }

    /* Status badges */
    .status-badges { display:flex; gap:8px; margin-top:10px; flex-wrap:wrap; }
    .badge { font-size:11px; padding:4px 8px; border-radius:10px; background:linear-gradient(90deg,#22303b,#1a242c); box-shadow:0 0 0 1px rgba(255,255,255,0.05); letter-spacing:.5px; opacity:.75; }
    .badge.active { background:linear-gradient(90deg,var(--accent2),var(--accent3)); color:#fff; opacity:1; }

    .core-wrapper.processing .circle::after { animation: breathing 2s ease-in-out infinite; filter:brightness(1.2); }
    .core-wrapper.speaking .circle { animation: spin 6s linear infinite; }
  </style>
</head>
<body>
  <h2>Nova Assistant</h2>
  <div class="subtitle">Intelligent local file assistant with LLM reasoning</div>

  <div id="core" class="core-wrapper">
    <div class="circle">NOVA</div>
    <div id="waveform" class="waveform hidden" aria-hidden="true">
      <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
      <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
    </div>
  </div>

  <div class="card" style="margin-top:28px;">
    <textarea id="prompt" placeholder="e.g. Create a folder named demo in Desktop and inside it add a file notes.txt containing two lines 'Hello' 'World'"></textarea>
    <div class="grid-row">
      <button id="sendBtn" title="Send prompt">▶ Send</button>
      <button id="clearBtn" class="secondary" title="Clear input">✕ Clear</button>
    </div>
    <div class="status-badges">
      <div id="badge-mode" class="badge active">LLM Mode</div>
      <div id="badge-processing" class="badge">Idle</div>
    </div>
  </div>

  <div id="pendingContainer" class="card compact" style="display:none; margin-top:20px;">
    <p class="pending-head">Pending destructive actions</p>
    <div id="pendingList"></div>
    <button id="confirmBtn" class="danger" style="margin-top:6px;">⚠ Confirm & Execute</button>
  </div>

  <div class="card compact" style="margin-top:22px;">
    <div id="log" class="log" aria-label="Activity log"></div>
  </div>

  <script>
    const promptEl = document.getElementById('prompt');
    const logEl = document.getElementById('log');
    const sendBtn = document.getElementById('sendBtn');
    const clearBtn = document.getElementById('clearBtn');
    const pendingContainer = document.getElementById('pendingContainer');
    const pendingListEl = document.getElementById('pendingList');
    const confirmBtn = document.getElementById('confirmBtn');
    const core = document.getElementById('core');
    const waveform = document.getElementById('waveform');
    const badgeProcessing = document.getElementById('badge-processing');
    let latestPending = [];

    function log(msg) {
      const time = new Date().toLocaleTimeString();
      logEl.textContent = `[${time}] ${msg}\n` + logEl.textContent;
    }

    async function sendPrompt() {
      const text = promptEl.value.trim();
      if (!text) return;
      sendBtn.disabled = true;
      setProcessing(true, 'Processing');
      log('Sending prompt...');

      try {
        const res = await window.nova.sendPrompt(text);
        if (res.error) { log(`Error: ${res.message || res.error}`); return; }

        log('Action: ' + JSON.stringify(res.action));

        const result = res.result;
        if (result?.status === 'requires_confirmation') {
          latestPending = result.pending || [];
          renderPending();
        } else {
          latestPending = [];
          pendingContainer.style.display = 'none';
          window.nova.speak('Done');
          log('Result: ' + JSON.stringify(result));
        }
      } catch (e) {
        log('Exception: ' + e);
      } finally {
        sendBtn.disabled = false;
        setProcessing(false, 'Idle');
      }
    }

    function renderPending() {
      pendingListEl.innerHTML = '';
      pendingContainer.style.display = latestPending.length ? 'block' : 'none';

      latestPending.forEach((item, idx) => {
        const div = document.createElement('div');
        div.className = 'pending-item';
        div.innerText = `${idx+1}. ${item.action} ${JSON.stringify(item.args)}`;
        pendingListEl.appendChild(div);
      });
    }

    async function confirmActions() {
      confirmBtn.disabled = true;
      const actions = latestPending.map(p => ({ action: p.action, args: p.args }));

      try {
        const res = await window.nova.confirmActions(actions);
        log('Confirm result: ' + JSON.stringify(res));
        pendingContainer.style.display = 'none';
        latestPending = [];
        window.nova.speak('Confirmed');
      } catch (e) {
        log('Confirm error: ' + e);
      } finally {
        confirmBtn.disabled = false;
      }
    }

    function setProcessing(active, label){
      if(active){
        badgeProcessing.textContent = label;
        badgeProcessing.classList.add('active');
        core.classList.add('processing');
        waveform.classList.remove('hidden');
      } else {
        badgeProcessing.textContent = label;
        badgeProcessing.classList.remove('active');
        core.classList.remove('processing');
        waveform.classList.add('hidden');
      }
    }

    sendBtn.addEventListener('click', sendPrompt);
    clearBtn.addEventListener('click', () => { promptEl.value = ''; });
    confirmBtn.addEventListener('click', confirmActions);
  </script>
</body>
</html>